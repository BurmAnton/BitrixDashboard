{% extends "base.html" %}
{% load dict_filters %}
{% block content %}

{% block extra_css %}
<style>
    form{ 
        text-align: left;
        padding: 12px;
        background-color: rgb(241, 241, 241);
        width: 35%;
        border-radius: 15px;
    }
    .container{
        width: 95%; 
        max-width: 95%;
        text-align: center;
    }

    .total-row{
        font-weight: bolder;
    }
    .total{
        padding: 7px;
        border-radius: 10px;
        background-color: rgb(0, 0, 0);
        color: rgb(255, 255, 255);
    }

    table.custom-dashboard {
    margin-bottom: 25px;
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    word-wrap: break-word;
    font-family: Arial, sans-serif;
    font-size: 14px;
    }

    table.custom-dashboard th, table.custom-dashboard td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
    vertical-align: middle;
    overflow-wrap: break-word;
    max-width: 150px;
    }

    table.custom-dashboard th {
    background-color: #f2f2f2;
    font-weight: bold;
    }

    table.custom-dashboard tr:nth-child(even) {
    background-color: #fafafa;
    }

    table.custom-dashboard tr:hover {
    background-color: #f1f1f1;
    }

    table.custom-dashboard td {
    white-space: normal;
    text-align: center;
    }

    table.custom-dashboard td:last-child {
        background-color: #f1f6f7;
    }
    .Success{
        padding: 7px;
        border-radius: 10px;
        background-color: #00A000;
        text-shadow: black 0px 0px 2px;
        color: white;
    }
    .Fail{
        padding: 7px;
        border-radius: 10px;
        background-color: #c4c401;
        text-shadow: black 0px 0px 2px;
        color: white;
    }
    .Empty{
        padding: 7px;
        border-radius: 10px;
        background-color: #bd0000;
        text-shadow: black 0px 0px 2px;
        color: white;
        ;
    }

</style>
{% endblock %}
    <form method="post" enctype="multipart/form-data">
    <h2>Импорт заявок из Excel</h2>
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit"></button>
    </form>
{% for prog, potoki in result.items %}
    <h3> Программа {{ prog }}</h1>
    <table border="1" class="custom-dashboard">
    <thead>
        <tr>
        <th>Имя</th>
        {% for topic, value in topics.items %}
            {% if topic == prog %}
                {% for index, name in value.items %}
                    <th>{{ name }}</th>
                {% endfor %}
            {% endif %}
        {% endfor %}
        <th>Итого</th>
        </tr>
    </thead>
    <tbody>
        {% for potok, listeners in potoki.items %}
        <tr>
            <td colspan="{{ topics|dict_get:prog|length|add:'2' }}" style="background:#ddd; font-weight:bold;">{{ potok }}</td>
        </tr>
            {% for name, tests in listeners.items %}
                {% if name == 'total' %}
                <tr class="total-row">
                <td>Общая сводка</td>
                {% for educ,topic  in topics.items %}
                    {% if educ == prog %}
                        {% for index, name in topic.items %}
                            <td>
                                <span class="total">
                                    {{tests|dict_get:name}}
                                </span>
                            </td>
                        {% endfor %}
                    {% endif %}
                {% endfor %}
                <td>
                    <span class="total">
                    {{tests.total}}
                    </span>
                </td>
                </tr>
                {% else %}
                <tr>
                <td>{{ name }}</td>
                {% for educ,topic  in topics.items %}
                    {% if educ == prog %}
                        {% for index, name in topic.items %}
                            <td>
                                {% with value=tests|dict_get:name %}
                                    {% if value > 60 %}
                                        <span class="Success">{{ value }}</span>
                                    {% elif value == 0 %}
                                        <span class="Empty">{{ value }}</span>
                                    {% else %}
                                        <span class="Fail">{{ value }}</span>
                                    {% endif %}
                                {% endwith %}
                            </td>
                        {% endfor %}
                    {% endif %}
                {% endfor %}
                <td>
                    {% with value=tests.total %}
                        {% if value == topics|dict_get:prog|length %}
                            <span class="Success">{{ value }}</span>
                        {% elif value == 0 %}
                            <span class="Empty">{{ value }}</span>
                        {% else %}
                            <span class="Fail">{{ value }}</span>
                        {% endif %}
                    {% endwith %}
                </td>
                </tr>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </tbody>
    </table>
{% endfor %}

{% endblock %}
